# Public, Private, and Elastic IP Addresses Overview

### Public IP Address
- lost when the instance is stopped
- if the instance is started up again you get a new public IP address
- no charge
- associated with a private IP on the instance
- cannot be moved accross instances

### Private IP Address
- retained when the instance is stopped
- what the OS sees


### Elastic IP Address
- Static public IP address
- retained when the instance is stopped
- charged if not used
- no charge if we do use them
- Can be moved between instances

---

## Network Address Translation - NAT

- When request enters VPC it is routed to Internet Gateway
- Internet Gateway performs NAT - Network Address Translation
  - Swaps public IP address (destination address) with the corresponding private IP address
  - sends request to appropriate instance

- When instance sends a response it is route to Internet Gateway
- Internet Gateway performs NAT - Network Address Translation
  - Swaps instance's private IP address with the corresponding public IP address (source address)

---

## Exercise

- Create an EC2 instance with SSH included in it's security group
- Notice the private IP address sits within the CIDR block of the containing subnet
- SSH into Instance
  - run `ifconfig`
  - see the private IP address listed under inet
  - notice no public IP address listed. Instance's OS does not know about the public IP

- In EC2 console
  - Take note of the public and private IP addresses
- Stop the instance
  - Notice the public IP goes away
- Start the instance
  - Notice there is a new public IP

---

## Public IP Address and Elanstic IP Address

- When stopping an instance
  - lose the public IP address
- When starting
  - new public IP Address

Elastic IP Address
- public facing IP address
- available on the internet
- retain IP address after starting / stopping the instance
- charged if
  - IP is not associated with an instances or an Elastic Network Adapters
  - The instance it is associated with is not running


- Can move an elastic IP address between instances and Elastic Network Adapters

## Elastic IP Addresses / Elastic Network Interfaces

- When we assign an elastic (static) IP address to an instance
  - the instance loses it's dynamic public IP address

- When you disassociate the Elastic IP address from an instance
  - instance receives a new dynamic public IP address

---

### Exercise 

- Launch 2 EC2 instances both in same subnet
- Allocate an Elastic IP Address
- Associate the Elastic IP Address to 1 EC2 instance

- Allocate new Elastic IP Address
- Create new network interface
  - MyENI
  - pick same subnet
  - Add name to network interface
- Associate Elastic IP with network interface
- Attach instance 1 to network interface
- notice in instance 1 we have
  - 2 elastic IP address
  - 2 network interface
- detach network interface from instance 1
- attach to instance 2

Clean up
- terminate EC2 instances
- after instances terminate
  - release elastic IP addresses
- delete elastic network interface

---

# Private Subnets and Bastion Hosts

- Public subnet
  - accessible from outside world
  - talks to Internet gateway
  - in VPC route table has entry for the igw

- Private subnet
  - not accessible from outside world
  - does not talk to internet gateway
  - has its own route table
  - In its route table does not have entry for igw
  - Instances in private subnet
    - don't have public IP addresses
    - only private IP addresses

Bastion Host / Jump Host
- Instance in public subnet that can talk to private subnet

- sets the rsa private key
  - `ssh-add -K path/to/rsa/private/key`
  - Next time we don't need to pass in private key to ssh

- Configure agent forwarding
  - ssh while also passing private key on file to public instance
  - allows us to ssh from this instance to another
  - `ssh -A ec2-user@<public-ip>`

---

### Exercise

- Create new route table
  - name - RT1
  - associate to a vpc

- Create subnet
  - name - PrivateSubnet1
  - associate vpc
  - associate to particular AZ
  - assign CIDR block for subnet
    - use subnet calculator

- Create second subnet
  - name - PrivateSubnet2
  - associate to different AZ

- In created Route Table - RT1
  - Associate new subnets in route table

- Launch instance into public subnet
  - give ssh
- Launch instance into private subnet
  - give ssh

- sets the rsa private key
  - `ssh-add -K path/to/rsa/private/key`

- Configure agent forwarding
  - `ssh -A ec2-user@<public-ip>`

- SSH into public instance
- SSH into private instance

- private instance cannot communicate with outside world
- try pinging google from private instance

---











